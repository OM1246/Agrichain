<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal ‚Äî AgriChain</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script>
        // Auth Gatekeeper: Immediate redirection if not logged in
        if (!localStorage.getItem('adminToken')) {
            window.location.href = 'admin-auth.html';
        }
    </script>
</head>
<body>

    <nav class="glass-nav">
        <div class="logo">Agri<span>Chain</span></div>
        <div class="nav-links">
            <a href="index.html">Dashboard</a>
            <a href="farmer-auth.html">Farmer</a>
            <a href="seller-auth.html">Seller</a>
            <a href="admin.html" class="active">Admin</a>
        </div>
        <div style="display:flex; gap:10px; align-items: center;">
            <div style="color:var(--gray); font-size:0.9rem; font-weight:600;">
                <span style="color:var(--emerald-dim); margin-right:4px;">üõ°Ô∏è</span> <span>Admin</span>
            </div>
            <button onclick="handleAdminLogout()" class="btn-primary" style="background:rgba(255,59,48,0.1); border:1px solid rgba(255,59,48,0.2); color:#ff3b30; padding: 8px 16px;">üö™ Logout</button>
            <button id="connectWalletBtn" class="btn-primary">üîó Connect Wallet</button>
        </div>
    </nav>

    <main class="container" style="padding-top:3rem;padding-bottom:5rem;">

        <!-- Header -->
        <div class="animate-up" style="margin-bottom:2.5rem;">
            <div class="badge" style="color:var(--sapphire);background:var(--sapphire-dim);border-color:rgba(61,158,255,0.25);">üõ°Ô∏è Admin Portal</div>
            <h1 class="section-title" style="font-size:2.5rem;margin-top:0.5rem;">Admin Dashboard</h1>
            <p style="color:var(--gray);max-width:450px;margin-top:0.5rem;">Review and manage products listed by sellers on the marketplace.</p>
        </div>

        <div class="animate-up" style="margin-bottom:2rem; display: flex; align-items: flex-end; width: 100%;">
            <!-- Tab Navigation (Left Aligned) -->
            <div class="auth-tabs" style="margin-bottom: 0; padding: 4px; width: fit-content;">
                <div class="auth-tab active" id="tabPending" onclick="switchAdminTab('pending')" style="display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 8px 16px;">
                    <span style="font-size: 1.2rem;">‚è≥</span>
                    <span>Pending</span>
                </div>
                <div class="auth-tab" id="tabAccepted" onclick="switchAdminTab('accepted')" style="display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 8px 16px;">
                    <span style="font-size: 1.2rem;">‚úÖ</span>
                    <span>Accepted</span>
                </div>
                <div class="auth-tab" id="tabDeclined" onclick="switchAdminTab('declined')" style="display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 8px 16px;">
                    <span style="font-size: 1.2rem;">‚ùå</span>
                    <span>Declined</span>
                </div>
                <div class="auth-tab" id="tabAnalytics" onclick="switchAdminTab('analytics')" style="display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 8px 16px;">
                    <span style="font-size: 1.2rem;">üìä</span>
                    <span>Analytics</span>
                </div>
            </div>
        </div>

        <!-- Pending Tab -->
        <div id="panelPending" class="tab-content animate-up" style="animation-delay: 0.1s;">
            <div class="glass-card" style="padding: 2.5rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h3 style="font-size: 1.5rem; font-weight: 800; color: #fff;">Pending Listings</h3>
                </div>
                <div id="approvalsGrid" class="marketplace-grid"></div>
                <div id="noApprovals" class="empty-state-v2 hidden">
                    <div class="empty-state-icon">‚úÖ</div>
                    <h3 style="font-size:1.5rem;color:#fff;margin-bottom:0.5rem;">All Caught Up!</h3>
                    <p style="color:var(--gray);font-size:1rem;">There are no pending products waiting for approval right now.</p>
                </div>
            </div>
        </div>

        <!-- Accepted Tab -->
        <div id="panelAccepted" class="tab-content hidden animate-up">
            <div class="glass-card" style="padding: 2.5rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h3 style="font-size: 1.5rem; font-weight: 800; color: #fff;">Accepted Products</h3>
                </div>
                <div id="acceptedGrid" class="marketplace-grid"></div>
                <div id="noAccepted" class="empty-state-v2 hidden">
                    <div class="empty-state-icon">üì¶</div>
                    <h3 style="font-size:1.5rem;color:#fff;margin-bottom:0.5rem;">No Accepted Products</h3>
                </div>
            </div>
        </div>

        <!-- Declined Tab -->
        <div id="panelDeclined" class="tab-content hidden animate-up">
            <div class="glass-card" style="padding: 2.5rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h3 style="font-size: 1.5rem; font-weight: 800; color: #fff;">Declined Products</h3>
                </div>
                <div id="declinedGrid" class="marketplace-grid"></div>
                <div id="noDeclined" class="empty-state-v2 hidden">
                    <div class="empty-state-icon">‚ú®</div>
                    <h3 style="font-size:1.5rem;color:#fff;margin-bottom:0.5rem;">No Declined Products</h3>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="panelAnalytics" class="tab-content hidden animate-up">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <div>
                    <h2 class="section-title" style="font-size:1.8rem;margin-bottom:0.5rem;">Platform Analytics</h2>
                    <div style="width: 50px; height: 3px; background: var(--sapphire); border-radius: 99px;"></div>
                </div>
                <!-- Timeframe Selection & Download -->
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <div style="position: relative;">
                        <select id="analyticsTimeframe" onchange="loadAnalytics()" style="appearance: none; background: var(--surface); border: 1px solid var(--border); color: #fff; padding: 10px 35px 10px 15px; border-radius: var(--r-md); font-size: 0.9rem; font-weight: 600; cursor: pointer;">
                            <option value="weekly">üìÖ Last 7 Days (Weekly)</option>
                            <option value="monthly">üìÖ Last 30 Days (Monthly)</option>
                            <option value="yearly">üìÖ Last 12 Months (Yearly)</option>
                        </select>
                        <span style="position: absolute; right: 12px; top: 11px; pointer-events: none; font-size: 0.8rem; color: var(--gray);">‚ñº</span>
                    </div>
                
                    <button class="btn-primary" onclick="downloadAnalyticsJSON()" style="background:var(--sapphire); color:#fff; display:flex; align-items:center; gap:8px;">
                        ‚¨áÔ∏è Download CSV
                    </button>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="portal-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-bottom: 2rem;">
                <div class="glass-card" style="text-align:center; padding: 1.5rem;">
                    <div style="font-size:0.85rem;color:var(--gray-dim);text-transform:uppercase;letter-spacing:1px;margin-bottom:0.5rem;font-weight:700;">Daily Rentals</div>
                    <div id="statDailyRentals" style="font-size:2rem;font-weight:800;color:var(--sapphire);">0</div>
                </div>
                <div class="glass-card" style="text-align:center; padding: 1.5rem;">
                    <div style="font-size:0.85rem;color:var(--gray-dim);text-transform:uppercase;letter-spacing:1px;margin-bottom:0.5rem;font-weight:700;">Daily Sold</div>
                    <div id="statDailySold" style="font-size:2rem;font-weight:800;color:var(--emerald);">0</div>
                </div>
                <div class="glass-card" style="text-align:center; padding: 1.5rem;">
                    <div style="font-size:0.85rem;color:var(--gray-dim);text-transform:uppercase;letter-spacing:1px;margin-bottom:0.5rem;font-weight:700;">Weekly Trans.</div>
                    <div id="statWeeklyTx" style="font-size:2rem;font-weight:800;color:#fff;">0</div>
                </div>
                <div class="glass-card" style="text-align:center; padding: 1.5rem;">
                    <div style="font-size:0.85rem;color:var(--gray-dim);text-transform:uppercase;letter-spacing:1px;margin-bottom:0.5rem;font-weight:700;">Monthly Trans.</div>
                    <div id="statMonthlyTx" style="font-size:2rem;font-weight:800;color:#fff;">0</div>
                </div>
            </div>
            
            <div class="glass-card">
                <h3 style="font-size:1.1rem; font-weight:600; margin-bottom:1.5rem;">Transaction Volume (Last 7 Days)</h3>
                <div style="width:100%; height:300px; position:relative;">
                    <canvas id="adminAnalyticsChart"></canvas>
                </div>
            </div>
        </div>
    </main>

    <script src="js/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script type="module" src="js/global.js"></script>
    <script type="module" src="js/admin.js"></script>
</body>
</html>
